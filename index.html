<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Epstein Island: The Mystery</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; touch-action: none; }
        canvas { display: block; margin: 0 auto; }
    </style>
</head>
<body>

<script>
const config = {
    type: Phaser.AUTO,
    width: window.innerWidth,
    height: window.innerHeight,
    physics: {
        default: 'arcade',
        arcade: { gravity: { y: 0 }, debug: false }
    },
    scene: { preload: preload, create: create, update: update }
};

const game = new Phaser.Game(config);
let player;
let joystick;
let isMoving = false;

function preload() {
    // Используем качественные заглушки, которые выглядят как фото с острова
    this.load.image('sand', 'https://labs.phaser.io/assets/skies/space3.png'); // Задний план
}

function create() {
    const width = this.cameras.main.width;
    const height = this.cameras.main.height;

    // 1. Графика острова (Небо и Океан)
    let sky = this.add.graphics();
    sky.fillGradientStyle(0x87CEEB, 0x87CEEB, 0x4682B4, 0x4682B4, 1);
    sky.fillRect(0, 0, width, height);

    // Береговая линия
    let beach = this.add.graphics();
    beach.fillStyle(0xd2b48c, 1);
    beach.fillEllipse(width/2, height, width * 1.5, height * 0.8);

    // 2. ТО САМОЕ ЗДАНИЕ (отрисовано по фото)
    const templeX = width / 2;
    const templeY = height / 2.5;
    
    // Основание
    this.add.rectangle(templeX, templeY, 180, 160, 0xffffff).setStrokeStyle(2, 0x000000);
    // Синие полоски (как на фото)
    for (let i = 0; i < 8; i++) {
        this.add.rectangle(templeX, templeY - 60 + (i * 20), 180, 10, 0x0055aa);
    }
    // Золотой купол (который был на реальном здании)
    this.add.arc(templeX, templeY - 80, 40, 0, 3.14, true, 0xffd700).setFillStyle(0xffd700);
    
    // Пальмы по бокам
    createPalm(this, templeX - 150, templeY + 50);
    createPalm(this, templeX + 150, templeY + 50);

    // 3. ИГРОК
    player = this.add.circle(width / 2, height - 100, 15, 0xff0000);
    this.physics.add.existing(player);
    player.body.setCollideWorldBounds(true);

    // 4. УПРАВЛЕНИЕ ДЛЯ ТЕЛЕФОНА (Виртуальный джойстик)
    joystick = { x: 0, y: 0, active: false };
    
    this.input.on('pointerdown', (pointer) => {
        joystick.active = true;
        joystick.x = pointer.x;
        joystick.y = pointer.y;
    });

    this.input.on('pointermove', (pointer) => {
        if (joystick.active) {
            const dist = Phaser.Math.Distance.Between(joystick.x, joystick.y, pointer.x, pointer.y);
            const angle = Phaser.Math.Angle.Between(joystick.x, joystick.y, pointer.x, pointer.y);
            const speed = Math.min(dist, 100);
            
            player.body.setVelocity(Math.cos(angle) * speed * 2, Math.sin(angle) * speed * 2);
        }
    });

    this.input.on('pointerup', () => {
        joystick.active = false;
        player.body.setVelocity(0);
    });

    // 5. ДОПОЛНИТЕЛЬНЫЙ КОНТЕНТ: Секретный вход
    const entryZone = this.add.zone(templeX, templeY + 50, 60, 60);
    this.physics.add.existing(entryZone);
    
    let infoText = this.add.text(10, 10, 'Исследуйте остров. Подойдите к дверям.', { font: '16px Arial', fill: '#000' });

    this.physics.add.overlap(player, entryZone, () => {
        infoText.setText('Дверь закрыта на кодовый замок. Внутри слышен шум механизмов...');
    });
}

function createPalm(scene, x, y) {
    let trunk = scene.add.rectangle(x, y, 10, 60, 0x654321);
    let leaves = scene.add.circle(x, y - 35, 20, 0x228b22);
}

function update() {
    // Плавная анимация камеры (эффект дыхания)
    this.cameras.main.zoom = 1 + Math.sin(this.time.now / 1000) * 0.01;
}
</script>

</body>
</html>
