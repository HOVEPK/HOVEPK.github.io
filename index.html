<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Вымышленный остров</title>
<style>
  body { margin: 0; overflow: hidden; }
  canvas { display: block; }
</style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/PointerLockControls.js"></script>

<script>
let scene, camera, renderer, controls;

init();
animate();

function init() {
  // Сцена
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x87ceeb); // небо

  // Камера
  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.set(0, 2, 5);

  // Рендерер
  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Освещение
  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(5,10,7);
  scene.add(light);

  const ambient = new THREE.AmbientLight(0x404040, 0.7);
  scene.add(ambient);

  // Остров (земля)
  const geometryIsland = new THREE.CylinderGeometry(20, 20, 1, 32);
  const materialIsland = new THREE.MeshLambertMaterial({color: 0x228B22});
  const island = new THREE.Mesh(geometryIsland, materialIsland);
  island.position.y = -0.5;
  scene.add(island);

  // Вода вокруг
  const geometryWater = new THREE.CylinderGeometry(50, 50, 0.1, 32);
  const materialWater = new THREE.MeshLambertMaterial({color: 0x1E90FF, transparent:true, opacity:0.6});
  const water = new THREE.Mesh(geometryWater, materialWater);
  water.position.y = -0.55;
  scene.add(water);

  // Несколько особняков
  for(let i=0; i<5; i++){
    const houseGeo = new THREE.BoxGeometry(3,2,3);
    const houseMat = new THREE.MeshLambertMaterial({color: 0xFFD700});
    const house = new THREE.Mesh(houseGeo, houseMat);
    house.position.set(Math.random()*30-15,1,Math.random()*30-15);
    scene.add(house);

    // Крыша
    const roofGeo = new THREE.ConeGeometry(2,1.5,4);
    const roofMat = new THREE.MeshLambertMaterial({color:0x8B0000});
    const roof = new THREE.Mesh(roofGeo, roofMat);
    roof.position.set(house.position.x,2.75,house.position.z);
    roof.rotation.y = Math.PI/4;
    scene.add(roof);
  }

  // Контролы для телефона/мыши
  controls = new THREE.PointerLockControls(camera, renderer.domElement);

  document.body.addEventListener('click', () => {
    controls.lock();
  });

  // Адаптивный размер
  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });

  // Пол (для коллизий)
  const floorGeo = new THREE.PlaneGeometry(100,100);
  const floorMat = new THREE.MeshBasicMaterial({visible:false});
  const floor = new THREE.Mesh(floorGeo,floorMat);
  floor.rotation.x = -Math.PI/2;
  scene.add(floor);
}

// Движение
const velocity = new THREE.Vector3();
const direction = new THREE.Vector3();
const moveForward = false;
const moveBackward = false;
const moveLeft = false;
const moveRight = false;

const keys = {};
document.addEventListener('keydown',(e)=>{keys[e.code]=true;});
document.addEventListener('keyup',(e)=>{keys[e.code]=false;});

function animate() {
  requestAnimationFrame(animate);

  if(controls.isLocked){
    const speed = 0.1;
    direction.z = Number(keys['KeyS']) - Number(keys['KeyW']);
    direction.x = Number(keys['KeyD']) - Number(keys['KeyA']);
    direction.normalize();

    controls.moveRight(direction.x*speed);
    controls.moveForward(direction.z*speed);
  }

  renderer.render(scene,camera);
}
</script>
</body>
</html>
